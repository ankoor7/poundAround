<!DOCTYPE html>
<html>
<head>
	<title>PoundAround</title>
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Expires" content="0">
	<link href="default.css" media="screen" rel="stylesheet" type="text/css" />
	<link href="levels/map.css" media="screen" rel="stylesheet" type="text/css" />
	<link href="levels/level_1.css" media="screen" rel="stylesheet" type="text/css" />
	<link href="levels/level_2.css" media="screen" rel="stylesheet" type="text/css" />
	<link href="levels/level_3.css" media="screen" rel="stylesheet" type="text/css" />
	<link href="levels/level_4.css" media="screen" rel="stylesheet" type="text/css" />
	<link href="levels/level_5.css" media="screen" rel="stylesheet" type="text/css" />
	<script src="javascripts/jquery-1.7.1.min.js" type="text/javascript"></script>
	<script src="javascripts/preloadCssImages.jQuery_v5.js" type="text/javascript"></script>
	<script src="javascripts/application.js" type="text/javascript"></script>
</head>
<body>
	<div id="outer" class="center">

		<div id="logo" class="center"></div>
		<p id="textStatus" align="center">
		</p>
		<div id="enter-button" class="button center" style="visibility: hidden;"></div>

	</div>
</body>
</html>

<script type="text/javascript">

// preload all images
$(document).ready(function() {
	$.preloadCssImages({statusTextEl: '#textStatus'}, function(){
		$("#textStatus").hide();
		$('#enter-button').css("visibility", "");
	});
});

numOfLevels=5;

var colors = new Array();
colors[0]="#FF1D25";
colors[1]="#3FA8F4";
colors[2]="#00A14F";
colors[3]="#FEC01E";

var prize = new Array();
for (var i=1; i < numOfLevels; i++) {
	prize[i]=false;
}


var red=0;
var blue=1;
var green=2;
var yellow=3;

var answer;
var flag=false;

Storage.prototype.setObject = function(key, value) {
    this.setItem(key, JSON.stringify(value));
}

Storage.prototype.getObject = function(key) {
    var value = this.getItem(key);
    return value && JSON.parse(value);
}
//init level
var level = 0;

var levels={1 : {"name":"Europe", "question":"Can you buy a mobile for a £1?", 'answer':'yes', 'currency':'1$'},
						2 : {"name":"Asia", "question":"How much curry can you buy for £1?", 'answer':'4', 'currency':'1$'},
						3 : {"name":"Australia", "question":"How many trees can you save in the rainforest for a £1?", 'answer':'3', 'currency':'1$'},
						4 : {"name":"Africa", "question":"In Egypt, which of these can you have for a £1?", 'answer':'4', 'currency':'1$'},
						5 : {"name":"America", "question":"If you put £1 into this chewing gum machine how many sticks would you get?", 'answer':'3', 'currency':'1$'} };

localStorage.setObject('levels', levels);

$("#enter-button").click(function() {
	goToMap();
});

function updateMapStamps(){
	var db_levels = localStorage.getObject('levels');
	for (var i=1; i<=level; i++){
		var db_level = db_levels[i];
		var id = '#' + db_level.name + '-map-stamp';
		// console.log(db_level.name + '-map-stamp');
		if (!prize[i])
				$(id).css("background-image", "url(images/map/fish_small.png)");
				$(id).css("visibility", "visible");
	}
}

function goToMap() {
	$("#outer").load('levels/map.html', function(response, status, xhr) {
		//console.log(response);
		if (status == "error") {
			var msg = "Sorry but there was an error: ";
			// console.log(msg + xhr.status + " " + xhr.statusText);
		} else {
			updateMapStamps();
			mapReady();
		}
	});
}

function goToLevel() {
	$('#next-button').click(function() {
		if (flag==false) {
			flag=true;
			$("#question").hide();
			$("#answer").append("<img id='level-prize' src=''/>");
			var db_level = localStorage.getObject('levels')[level];
			if (answer == db_level.answer) {
				$("#a-headline").append("That is the right answer, you got the stamp!!!");
				$("#answer img").attr("src","images/Success_Page/" + level + ".png");
				$("#answer img").addClass("stamp");
				prize[level]=true;
			} else {
				$("#a-headline").append("Wrong answer, you got a stinky fish.");
				$("#answer img").attr("src","images/Success_Page/Fish.png");
				$("#answer img").addClass("fish");
			}
			$("#answer").show();
		}else {
			goToMap();
			flag=false;
		}
	});
	
	switch(level) {
		case 1:
			level_1(level);
			break;
		case 2:
			level_2(level);
			break;
		case 3:
			level_2(level);
			break;
		case 4:
			level_2(level);
			break;
		case 5:
			level_5(level);
			break;
	}
}

function mapReady(){
	// console.log(level);
	switch(level)
	{
		case 0:
		$("#map").css('background-image', "url(images/map/Level_1B.png)");
		break;
		case 1:
		$("#map").css("background-image", "url(images/map/Level_2B.png)");
		break;
		case 2:
		$("#map").css("background-image", "url(images/map/Level_3B.png)");
		break;
		case 3:
		$("#map").css("background-image", "url(images/map/Level_4B.png)");
		break;
		case 4:
		$("#map").css("background-image", "url(images/map/Level_5B.png)");
		break;
		case 5:
		$("#map").css("background-image", "url(images/map/Complete_mapB.png)");
		$("#play-button").attr("id", "prize-button");
		$("#play-button").attr("src", "images/map/Prize_button.png");
		$("a").attr("href", "#")
		$("#congrats").css("background-image", "url(images/map/congrats.png)");
		break;
		default:
		// console.log(level);
	}

	$("#prize-button").click(function() {
		$("#outer").load('levels/prize.html', function(response, status, xhr) {
			//console.log(response);
			if (status == "error") {
				var msg = "Sorry but there was an error: ";
				// console.log(msg + xhr.status + " " + xhr.statusText);
			} else {
				var video = document.getElementById('prize-video');
				  video.play();
			}
		});
	});

	$("#play-button").click(function() {
		// console.log("level: "+level);
		//$("#outer").empty();
		//Load level page layout
		$("#outer").load('levels/show.html', function(response, status, xhr) {
			//console.log(response);
			if (status == "error") {
				var msg = "Sorry but there was an error: ";
				// console.log(msg + xhr.status + " " + xhr.statusText);
			} else {
				//Load Level content
				level++;
				loadLevelContent();
			}
		});
	});
}

function loadLevelContent() {
	// Retrieve the object from storage
	 var db_level = localStorage.getObject('levels')[level];
	//add qurstion description
	$("#q-headline h1:first-child").append(db_level.question);
	$("#currency span").append(db_level.currency);
	//load question
	$("#level-content").load('levels/level_' + level + '.html', function(response, status, xhr) {
		//console.log(response);
		goToLevel();
		if (status == "error") {
			var msg = "Sorry but there was an error: ";
			// console.log(msg + xhr.status + " " + xhr.statusText);
		}else {}
	});
}

function switchImg(img){
	if (img.src.match(/_on/)) {
		answer = 0;
		switchAllImgesOff();
	}else {
		switchAllImgesOff();
		img.src = img.src.replace(/_off/, "_on");
		answer = img.id.split('-')[1];
	}
}

function switchAllImgesOff() {
	$("#multi-choice img").each(function() {
		this.src = this.src.replace(/_on/, "_off");
	});
}

function level_2() {
	$("#multi-choice img").click(function(){
		switchImg(this);
	});	
}

function level_5(){
	var checked = new Array();
	answer=0;
	$('.ball').click(function() {
		var id = this.id;
		var ballNum = id.split('-')[1];
		if (checked[ballNum] != true) {
			checked[ballNum] = true;
			$(this).css("background-color", colors[ballNum % colors.length]);
			answer++;
		} else {
			checked[ballNum] = false;
			$(this).css("background-color", "");
			answer--;
		}
	});
}

function switchBox(box){
	switchAllBoxesOff();
	$(box).toggleClass("on");
	answer = box.id.split('-')[0];
	$(".question-graphic img").attr("src", "images/levels/lev1_" + answer + ".png")
}

function switchAllBoxesOff() {
	$(".check-box").each(function() {
		$(this).removeClass("on");
	});
}

function level_1(level){
	$(".check-box").click(function(){
		switchBox(this);
	});
}

	</script>